# Alembic Docs

[Alembic](https://alembic.sqlalchemy.org/en/latest/index.html) is a database migrations tool written by the author of [SQLAlchemy](http://www.sqlalchemy.org/) to be used every time that there's an update that will affect the current database.
If you did an upgrade on the [Database Models](../../otter_welcome_buddy/database/models), you should add a new revision that will be applied when the bot goes online. In order to do that, follow this steps:

1. Do the modifications on the Database Models.
2. From your shell, run the following command:

```bash
alembic revision â€” autogenerate -m "<description_of_your_change>"
```

3. This will generate a new file under the [versions folder](versions/). Identify that file and open it.
4. Modify the methods `upgrade()` and `downgrade()` with the proper changes to run the migration. You can use some help like [ChatGPT](https://chat.openai.com/chat) (or similar) giving the previous model and the modifications that you made and ask it to give you the Alembic requirements to run the migration.
   1. When adding the upgrade, is highly encouraged that you first check if your new table/column/relation exists, and if not do the changes. This is because the migration will run automatically every time that the bot start, and if the migration was done before we don't need the changes anymore.
5. The migration will automatically run when the bot starts.

## Troubleshooting

As the migration run automatically every time that the bot starts, if there's any issue with it the bot will be unable to start. You can manually run the migration using:

```bash
alembic upgrade head
```

And this will execute the [script.py.mako](data/migrations/script.py.mako) present here which is an autogenerated file from Alembic, you can read the documentation linked at the top to learn more about it.